# Synthetic NVSS Data

This directory contains code to generate synthetic mortality records in IJE format and to convert
these records to FHIR JSON format or to S10 format.

## Dependencies

This code requires the ruby language to be installed, along with some ruby library depencencies. After installing ruby, install the ruby library dependencies by running:

```
bundle install
```

## Generating IJE data

To generate IJE records use the following command

```
bundle exec ruby generate_synthetic_ije_records.rb <year> <number-of-records> <optional-jurisdiction>
```

This command accepts the following arguments:

* **year** (required): the year to use for all generated records
* **number-of-records** (required): the number of records to generate
* **optional-jurisdiction** (optional): the jurisdiction for which to generate records

The IJE records are written to standard out, one record per line, and can be redirected to a file. For example,

```
bundle exec ruby generate_synthetic_ije_records.rb 2025 50 > synthetic_records.ije
```

The above command generates 50 synthetic records for 2025 and writes them to the file 'synthetic_records.ije'

## Generating FHIR JSON Files

A script that takes one or more IJE files (e.g., as generated by the `generate_synthetic_ije_records.rb` script) and generates individual JSON files for each record in an output directory. To run, use something like

```
bundle exec ruby ije_to_fhir.rb fhir_output synthetic_records.ije
```

The above command creates a fhir_output directory and writes individual FHIR JSON files for each record to that directory.

## Generating S10 Files

A script that takes one or more IJE files (e.g., as generated by the `generate_synthetic_ije_records.rb` script) and converts the records to S10 (e.g., SuperMicar fixed length format) format, one record per line. To run, use something like

```
bundle exec ruby ije_to_s10.rb synthetic_records.ije > synthetic_records.s10
```

The above command creates a file called 'synthetic_records.s10' with the relevant data extracted from IJE and converted to S10.
